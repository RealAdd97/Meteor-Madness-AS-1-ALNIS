
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEO Mining Corporation - Enhanced</title>
<style>
  .notification {position: fixed; top: 20px; right: 400px; padding: 15px 20px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 13px; font-weight: bold; box-shadow: 0 4px 20px rgba(0,0,0,0.5); z-index: 999; pointer-events: none; animation: slideIn 0.4s ease-out, fadeOut 0.5s ease-in 3.5s; min-width: 250px; max-width: 400px; border: 2px solid;}
.notification.success {background: rgba(0, 255, 136, 0.95); color: #003322; border-color: #00ff88; box-shadow: 0 4px 20px rgba(0,255,136,0.4);}
.notification.danger {background: rgba(255, 51, 51, 0.95); color: #fff; border-color: #ff3333; box-shadow: 0 4px 20px rgba(255,51,51,0.4);}
.notification.info {background: rgba(0, 170, 255, 0.95); color: #fff; border-color: #00aaff; box-shadow: 0 4px 20px rgba(0,170,255,0.4);}
.notification.warning {background: rgba(255, 170, 0, 0.95); color: #000; border-color: #ffaa00; box-shadow: 0 4px 20px rgba(255,170,0,0.4);}
@keyframes slideIn {from {transform: translateX(100%); opacity: 0;} to {transform: translateX(0); opacity: 1;}}
@keyframes fadeOut {from {opacity: 1;} to {opacity: 0;}}
* {margin: 0; padding: 0; box-sizing: border-box;}
body {font-family: 'Courier New', monospace; background: linear-gradient(to bottom, #000011, #000033); color: #00ff88; overflow: hidden;}
#gameContainer {display: flex; height: 100vh;}
#canvasSection {flex: 1; position: relative;}
#gameCanvas {display: block; background: radial-gradient(circle at center, #001133, #000000); cursor: move;}
#zoomControls {position: absolute; top: 20px; left: 20px; display: flex; flex-direction: column; gap: 10px;}
.zoom-btn {width: 40px; height: 40px; background: rgba(0, 100, 200, 0.8); border: 2px solid #00aaff; color: white; font-size: 20px; cursor: pointer; border-radius: 5px; transition: all 0.3s;}
.zoom-btn:hover {background: rgba(0, 150, 255, 0.9); box-shadow: 0 0 15px #00aaff;}
#interface {width: 380px; background: rgba(0, 20, 40, 0.95); border-left: 2px solid #00ff88; padding: 20px; overflow-y: auto;}
h1 {color: #00ffff; font-size: 24px; margin-bottom: 20px; text-align: center; text-shadow: 0 0 10px #00ffff;}
.stat {margin: 10px 0; padding: 10px; background: rgba(0, 255, 136, 0.1); border: 1px solid #00ff88; border-radius: 5px;}
.stat-label {color: #00ffff; font-size: 12px;}
.stat-value {font-size: 18px; font-weight: bold;}
.warning {color: #ff3333; animation: pulse 1s infinite;}
@keyframes pulse {0%,100% {opacity:1;} 50% {opacity:0.5;}}
.neo-list {margin-top: 20px;}
.neo-item {background: rgba(0, 100, 200, 0.2); border: 1px solid #0088ff; border-radius: 5px; padding: 12px; margin: 10px 0; cursor: pointer; transition: all 0.3s;}
.neo-item:hover {background: rgba(0, 100, 200, 0.4); transform: translateX(5px);}
.neo-item.selected {border-color: #00ff88; background: rgba(0, 255, 136, 0.2);}
.neo-name {font-size: 16px; font-weight: bold; margin-bottom: 5px;}
.neo-info {font-size: 11px; color: #88ccff; margin: 3px 0;}
.dangerous {color: #ff3333; font-weight: bold;}
.impact-timer {color: #ff3333; font-weight: bold; animation: pulse 1s infinite;}
button {width: 100%; padding: 12px; margin: 8px 0; background: linear-gradient(135deg, #0066cc, #0044aa); border: 2px solid #00aaff; color: #ffffff; font-family: 'Courier New', monospace; font-size: 14px; font-weight: bold; cursor: pointer; border-radius: 5px; transition: all 0.3s;}
button:hover:not(:disabled) {background: linear-gradient(135deg, #0088ff, #0066cc); box-shadow: 0 0 15px #00aaff;}
button:disabled {background: #333333; border-color: #666666; color: #999999; cursor: not-allowed; box-shadow: none;}
.deflect-btn {background: linear-gradient(135deg, #cc3300, #aa2200); border-color: #ff4400;}
.deflect-btn:hover:not(:disabled) {background: linear-gradient(135deg, #ff4400, #cc3300); box-shadow: 0 0 15px #ff4400;}
.upgrade-btn {background: linear-gradient(135deg, #6600cc, #4400aa); border-color: #aa00ff; font-size: 12px; padding: 8px;}
.upgrade-btn:hover:not(:disabled) {background: linear-gradient(135deg, #8800ff, #6600cc); box-shadow: 0 0 15px #aa00ff;}
#missionLog {display: none;}
.log-entry {margin: 5px 0; padding: 3px;}
.log-success {color: #00ff88;}
.log-danger {color: #ff3333;}
.log-info {color: #88ccff;}
.log-warning {color: #ffaa00;}
.game-over {position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.95); border: 3px solid #ff3333; padding: 40px; text-align: center; z-index: 1000; border-radius: 10px;}
.game-over h2 {color: #ff3333; font-size: 36px; margin-bottom: 20px; text-shadow: 0 0 20px #ff3333;}
.victory {border-color: #00ff88 !important;}
.victory h2 {color: #00ff88 !important; text-shadow: 0 0 20px #00ff88 !important;}
.tab-container {display: flex; gap: 5px; margin-bottom: 15px;}
.tab {flex: 1; padding: 8px; background: rgba(0, 100, 200, 0.3); border: 1px solid #0088ff; color: #88ccff; cursor: pointer; text-align: center; border-radius: 3px; font-size: 12px;}
.tab.active {background: rgba(0, 255, 136, 0.3); border-color: #00ff88; color: #00ff88;}
.tab-content {display: none;}
.tab-content.active {display: block;}
.upgrade-item {background: rgba(100, 0, 200, 0.2); border: 1px solid #aa00ff; padding: 10px; margin: 8px 0; border-radius: 5px;}
.upgrade-name {font-size: 14px; font-weight: bold; color: #cc88ff; margin-bottom: 5px;}
.upgrade-desc {font-size: 11px; color: #88ccff; margin-bottom: 5px;}
.upgrade-level {font-size: 11px; color: #ffaa00;}
.achievement {background: rgba(255, 200, 0, 0.2); border: 1px solid #ffaa00; padding: 8px; margin: 5px 0; border-radius: 3px; font-size: 11px;}
.achievement.unlocked {border-color: #00ff88; background: rgba(0, 255, 136, 0.2);}
.huz1-btn {
  width: 100px;
  height: 30px;
  margin-top: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  position: relative;
  background: #e62222;
  border: none;
  border-radius: 4px;
  box-shadow: 1px 1px 3px rgba(0,0,0,0.15);
  transition: 200ms;
  font-size: 10px; 
}

.huz1-btn span {
  transition: 200ms;
}

.huz1-text {
  transform: translateX(18px);
  color: white;
  font-weight: bold;
}

.huz1-icon {
  position: absolute;
  border-left: 1px solid #c41b1b;
  transform: translateX(65px);
  height: 22px;
  width: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.huz1-icon svg {
  width: 10px;
  fill: #eee;
}

.huz1-btn:hover {
  background: #ff3636;
}

.huz1-btn:hover .huz1-text {
  color: transparent;
}

.huz1-btn:hover .huz1-icon {
  width: 90px;
  border-left: none;
  transform: translateX(0);
}

.huz1-btn:focus {
  outline: none;
}

.huz1-btn:active .huz1-icon svg {
  transform: scale(0.8);
}
</style>
</head>
<body>
<div id="gameContainer">
  <div id="canvasSection">
    <canvas id="gameCanvas"></canvas>
    <div id="zoomControls">
      <button class="zoom-btn" id="zoomInBtn">+</button>
      <button class="zoom-btn" id="zoomOutBtn">−</button>
      <button class="zoom-btn" id="zoomResetBtn" style="font-size:16px;">⌂</button>
      <button class="huz1-btn" onclick="window.location.href='index.html'">
  <span class="huz1-text">Go Back</span>
  <span class="huz1-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path>
    </svg>
  </span>
</button>
    </div>
  </div>
  <div id="interface">
    <h1>NEO MINING CORP</h1>
    <div class="stat"><div class="stat-label">CAPITAL</div><div class="stat-value" id="credits">$1,000,000</div></div>
    <div class="stat"><div class="stat-label">TOTAL PROFIT</div><div class="stat-value" id="totalProfit">$0</div></div>
    <div class="stat"><div class="stat-label">ACTIVE SHIPS</div><div class="stat-value" id="activeShips">0/1</div></div>
    <div class="stat"><div class="stat-label">NEXT OP COST</div><div class="stat-value" id="nextOpCost">30s</div></div>

    <div class="tab-container">
      <div class="tab active" id="tab-missions">MISSIONS</div>
      <div class="tab" id="tab-upgrades">UPGRADES</div>
      <div class="tab" id="tab-goals">GOALS</div>
    </div>

    <div id="missions-tab" class="tab-content active">
      <div class="neo-list"><h3 style="color:#00ffff; margin-bottom:10px;">NEAR-EARTH OBJECTS</h3><div id="neoList"></div></div>
      <div id="selectedNEO" style="margin-top:20px;"></div>
    </div>

    <div id="upgrades-tab" class="tab-content">
      <h3 style="color:#00ffff; margin-bottom:10px;">RESEARCH & UPGRADES</h3>
      <div id="upgradesList"></div>
    </div>

    <div id="goals-tab" class="tab-content">
      <h3 style="color:#00ffff; margin-bottom:10px;">ACHIEVEMENTS</h3>
      <div id="achievementsList"></div>
    </div>

    <div id="missionLog" style="display:none;"><div class="log-entry log-info">System initialized. Welcome, Commander.</div></div>
  </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function resizeCanvas() {
  canvas.width = window.innerWidth - 380;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

function randResources() {
  return Math.floor(Math.random() * 5) + 1;
}

function impactTimeFromThreat(threatLevel) {
  const minSec = 25;
  const maxSec = 45;
  const t = Math.max(1, Math.min(10, Math.round(threatLevel)));
  const seconds = maxSec - ((t - 1) / 9) * (maxSec - minSec);
  return Math.floor(seconds * 1000);
}

const camera = {
  x: 0, y: 0, zoom: 1, targetZoom: 1, isDragging: false,
  dragStartX: 0, dragStartY: 0, startCameraX: 0, startCameraY: 0
};
document.getElementById('zoomInBtn').onclick = () => { camera.targetZoom = Math.min(camera.targetZoom * 1.3, 3); };
document.getElementById('zoomOutBtn').onclick = () => { camera.targetZoom = Math.max(camera.targetZoom / 1.3, 0.5); };
document.getElementById('zoomResetBtn').onclick = () => { camera.targetZoom = 1; camera.x = 0; camera.y = 0; };

const gameState = {
  credits: 1000000,
  totalProfit: 0,
  selectedNEO: null,
  missionsCompleted: 0,
  missionsFailed: 0,
  gameOver: false,
  gameWon: false,
  maxShips: 1,
  startTime: Date.now(),
  upgrades: {
    fuelEfficiency: 0,
    successBonus: 0,
    deflectionPower: 0,
    shipCapacity: 0
  },
  operationalCostPerCycle: 200000,
  lastOperationalCost: Date.now(),
  failureMultiplier: 1.5,
  dangerousSpawnRate: 0.9,
  achievements: {
    firstMillion: { unlocked: false, name: 'First Million', desc: 'Earn $1M profit' },
    safetyFirst: { unlocked: false, name: 'Safety First', desc: 'Deflect 3 asteroids', count: 0 },
    miningMogul: { unlocked: false, name: 'Mining Mogul', desc: 'Complete 50 missions' },
    perfectRecord: { unlocked: false, name: 'Perfect Record', desc: 'Complete 10 missions without failure', streak: 0 },
    entrepreneur: { unlocked: false, name: 'Entrepreneur', desc: 'Reach $5M capital' }
  }
};

const explosions = [];
const neos = [
  (function(){
    const tl = Math.floor(6 + Math.random()*4);
    return {id:1,name:'Apophis-22',x:0,y:0,angle:0,distance:180,speed:0.008,size:8,color:'#ffaa00',dangerous:true,threatLevel:tl,impactTime:impactTimeFromThreat(tl),miningValue:450000,fuelCost:90000,operationCost:60000,deflectCost:250000,failureRate:0.18,onMission:false,deflected:false,deflecting:false,deflectProgress:0,mineCount:0,maxMineCount: randResources(),depleting:false,depletionProgress:0};
  })(),
  {id:2,name:'Bennu-7',x:0,y:0,angle:1.5,distance:220,speed:0.006,size:10,color:'#00ffff',dangerous:false,miningValue:780000,fuelCost:140000,operationCost:90000,failureRate:0.08,onMission:false,mineCount:0,maxMineCount: randResources(),depleting:false,depletionProgress:0},
  {id:3,name:'Psyche-16',x:0,y:0,angle:3,distance:280,speed:0.004,size:14,color:'#cc88ff',dangerous:false,miningValue:1200000,fuelCost:200000,operationCost:130000,failureRate:0.12,onMission:false,mineCount:0,maxMineCount: randResources(),depleting:false,depletionProgress:0},
  (function(){
    const tl = Math.floor(6 + Math.random()*4);
    return {id:4,name:'Didymos-X',x:0,y:0,angle:4.2,distance:150,speed:0.012,size:6,color:'#ff4444',dangerous:true,threatLevel:tl,impactTime:impactTimeFromThreat(tl),miningValue:320000,fuelCost:70000,operationCost:45000,deflectCost:200000,failureRate:0.22,onMission:false,deflected:false,deflecting:false,deflectProgress:0,mineCount:0,maxMineCount: randResources(),depleting:false,depletionProgress:0};
  })(),
  {id:5,name:'Ryugu-5',x:0,y:0,angle:2.8,distance:200,speed:0.007,size:9,color:'#88ff88',dangerous:false,miningValue:580000,fuelCost:110000,operationCost:70000,failureRate:0.06,onMission:false,mineCount:0,maxMineCount: randResources(),depleting:false,depletionProgress:0},
  {id:6,name:'Oumuamua-2',x:0,y:0,angle:5.5,distance:320,speed:0.003,size:7,color:'#ff88ff',dangerous:false,miningValue:1500000,fuelCost:250000,operationCost:160000,failureRate:0.20,onMission:false,mineCount:0,maxMineCount: randResources(),depleting:false,depletionProgress:0}
];

let currentTab = 'missions';
document.getElementById('tab-missions').onclick=()=>switchTab('missions');
document.getElementById('tab-upgrades').onclick=()=>switchTab('upgrades');
document.getElementById('tab-goals').onclick=()=>switchTab('goals');
function switchTab(tab){
  currentTab=tab;
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.getElementById('tab-'+tab).classList.add('active');
  document.getElementById(tab+'-tab').classList.add('active');
  if(tab==='upgrades')renderUpgrades();
  if(tab==='goals')renderAchievements();
}

setInterval(()=>{
  if(gameState.gameOver) return;
  neos.forEach(neo=>{
    if(neo.dangerous && !neo.deflected && !neo.deflecting && neo.impactTime>0){
      neo.impactTime -= 100;
      if(neo.impactTime<=0){
        impactEarth(neo);
      }else if(neo.impactTime<=60000 && neo.impactTime%10000<100){
        showNotification(`WARNING: ${neo.name} impact in ${Math.ceil(neo.impactTime/1000)}s! (TL ${neo.threatLevel||'N/A'})`,'danger');
      }
    }
  });
  const timeSinceLastCost=Date.now()-gameState.lastOperationalCost;
  if(timeSinceLastCost>=30000){
    applyOperationalCost();
    gameState.lastOperationalCost=Date.now();
  }
  const neo = neos.find(n=>n.id===gameState.selectedNEO);
  if(neo && neo.dangerous && !neo.deflected && !neo.deflecting && neo.impactTime>0){
    const selectedDiv = document.getElementById('selectedNEO');
    const impactTimerEl = selectedDiv ? selectedDiv.querySelector('.impact-timer') : null;
    if(impactTimerEl){
      const minutes=Math.floor(neo.impactTime/60000);
      const seconds=Math.floor((neo.impactTime%60000)/1000);
      impactTimerEl.innerHTML=`⚠ IMPACT IN ${minutes}:${seconds.toString().padStart(2,'0')}`;
    }
  }
  updateUI();
},100);

function applyOperationalCost(){
  const cost = gameState.operationalCostPerCycle;
  gameState.credits -= cost;
  gameState.totalProfit -= cost;
  showNotification(`Operational costs: -$${cost.toLocaleString()}`,'warning');
  updateUI();
}

function worldToScreen(wx,wy){
  const centerX=canvas.width/2;
  const centerY=canvas.height/2;
  return {
    x:(wx+camera.x)*camera.zoom+centerX,
    y:(wy+camera.y)*camera.zoom+centerY
  };
}
canvas.addEventListener('mousedown', e=>{
  camera.isDragging = true;
  camera.dragStartX = e.clientX;
  camera.dragStartY = e.clientY;
  camera.startCameraX = camera.x;
  camera.startCameraY = camera.y;
});
canvas.addEventListener('mousemove', e=>{
  if(camera.isDragging){
    camera.x = camera.startCameraX + (e.clientX-camera.dragStartX)/camera.zoom;
    camera.y = camera.startCameraY + (e.clientY-camera.dragStartY)/camera.zoom;
  }
});
canvas.addEventListener('mouseup', ()=>{ camera.isDragging=false; });
canvas.addEventListener('mouseleave', ()=>{ camera.isDragging=false; });
canvas.addEventListener('wheel', e=>{
  e.preventDefault();
  const zoomFactor = e.deltaY>0?0.9:1.1;
  camera.targetZoom = Math.max(0.5, Math.min(3, camera.targetZoom*zoomFactor));
});

function animate(){
  camera.zoom += (camera.targetZoom-camera.zoom)*0.1;
  ctx.fillStyle='#000';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  drawStars();
  drawExplosions();
  drawEarth();
  drawNEOs();
  requestAnimationFrame(animate);
}
function drawStars(){
  for(let i=0;i<150;i++){
    const wx=((i*137.508)%800)-400;
    const wy=((i*197.352)%600)-300;
    const pos=worldToScreen(wx,wy);
    const size=(i%3)*0.5+0.5;
    ctx.fillStyle='#fff';
    ctx.globalAlpha=0.3+(i%4)*0.2;
    ctx.fillRect(pos.x,pos.y,size,size);
  }
  ctx.globalAlpha=1;
}
function drawEarth(){
  const radius=40;
  const pos=worldToScreen(0,0);
  const gradient=ctx.createRadialGradient(pos.x,pos.y,radius*camera.zoom*0.8,pos.x,pos.y,radius*camera.zoom*1.5);
  gradient.addColorStop(0,'rgba(0,150,255,0.3)');
  gradient.addColorStop(1,'rgba(0,150,255,0)');
  ctx.fillStyle=gradient;
  ctx.beginPath();
  ctx.arc(pos.x,pos.y,radius*camera.zoom*1.5,0,Math.PI*2);
  ctx.fill();
  ctx.fillStyle='#0088ff';
  ctx.beginPath();
  ctx.arc(pos.x,pos.y,radius*camera.zoom,0,Math.PI*2);
  ctx.fill();
  ctx.fillStyle='#00ff88';
  ctx.beginPath();
  ctx.arc(pos.x-10*camera.zoom,pos.y-5*camera.zoom,12*camera.zoom,0,Math.PI*2);
  ctx.fill();
  ctx.beginPath();
  ctx.arc(pos.x+8*camera.zoom,pos.y+10*camera.zoom,8*camera.zoom,0,Math.PI*2);
  ctx.fill();
}
function drawNEOs(){
  neos.forEach(neo=>{
    if(!neo.deflecting && !neo.depleting) neo.angle += neo.speed;
    neo.x = Math.cos(neo.angle)*neo.distance;
    neo.y = Math.sin(neo.angle)*neo.distance;
    const pos = worldToScreen(neo.x,neo.y);
    const centerPos = worldToScreen(0,0);
    if(!neo.deflecting && !neo.depleting){
      ctx.strokeStyle = neo.dangerous && !neo.deflected ? 'rgba(255,50,50,0.2)': 'rgba(100,100,100,0.2)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.arc(centerPos.x,centerPos.y,neo.distance*camera.zoom,0,Math.PI*2);
      ctx.stroke();
    }
    if(neo.deflecting){
      ctx.globalAlpha=1-neo.deflectProgress*0.7;
      ctx.strokeStyle='rgba(0,255,136,0.8)';
      ctx.lineWidth=2;
      ctx.beginPath();
      ctx.moveTo(centerPos.x,centerPos.y);
      ctx.lineTo(pos.x,pos.y);
      ctx.stroke();
      ctx.globalAlpha=1;
    }
    if(neo.depleting){
      ctx.globalAlpha=1-neo.depletionProgress;
      ctx.strokeStyle='rgba(255,200,0,0.6)';
      ctx.lineWidth=3;
      for(let i=0;i<3;i++){
        ctx.beginPath();
        ctx.arc(pos.x,pos.y,(neo.size+5+i*8)*camera.zoom*neo.depletionProgress,0,Math.PI*2);
        ctx.stroke();
      }
      ctx.globalAlpha=1;
    }
    ctx.fillStyle = neo.color;
    ctx.globalAlpha = neo.deflecting ? 1-neo.deflectProgress*0.5 : neo.depleting ? 1-neo.depletionProgress : 1;
    const currentSize = neo.depleting ? neo.size*(1-neo.depletionProgress*0.5) : neo.size;
    ctx.beginPath();
    ctx.arc(pos.x,pos.y,currentSize*camera.zoom,0,Math.PI*2);
    ctx.fill();
    if(neo.deflecting){
      ctx.strokeStyle = '#00ff88';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(pos.x,pos.y,(neo.size+4)*camera.zoom,0,Math.PI*2);
      ctx.stroke();
    }
    ctx.globalAlpha=1;
  });
}
function drawExplosions(){
  for(let i=explosions.length-1; i>=0; i--){
    const exp = explosions[i];
    ctx.fillStyle = `rgba(255,100,0,${1-exp.life/60})`;
    ctx.beginPath();
    const pos = worldToScreen(exp.x,exp.y);
    ctx.arc(pos.x,pos.y,exp.radius*camera.zoom*(1-exp.life/60),0,Math.PI*2);
    ctx.fill();
    exp.life--;
    if(exp.life<=0){
      explosions.splice(i,1);
    }
  }
}

function selectNEO(id){
  gameState.selectedNEO=id;
  renderSelectedNEO();
  renderNEOList();
}
function renderNEOList(){
  const list=document.getElementById('neoList');
  list.innerHTML='';
  neos.forEach(neo=>{
    const div=document.createElement('div');
    div.className='neo-item'+(gameState.selectedNEO===neo.id?' selected':'');
    const remaining=neo.maxMineCount-neo.mineCount;
    const fuelCost=Math.floor(neo.fuelCost*(1-gameState.upgrades.fuelEfficiency*0.1));
    const netProfit=neo.miningValue-fuelCost-neo.operationCost;
    div.innerHTML=
      `<div class="neo-name">${neo.name} ${neo.dangerous&&!neo.deflected?'⚠':''}${neo.onMission?'🚀':''}</div>
      <div class="neo-info">Net Profit: $${netProfit.toLocaleString()}</div>
      <div class="neo-info" style="color:#ffaa00;">Resources: ${remaining}/${neo.maxMineCount}</div>`;
    div.onclick=()=>selectNEO(neo.id);
    list.appendChild(div);
  });
}
function addLog(msg,type='info'){
  showNotification(msg, type);
}

function renderSelectedNEO(){
  const neo=neos.find(n=>n.id===gameState.selectedNEO);
  const div=document.getElementById('selectedNEO');
  if(!neo){ div.innerHTML=''; return; }
  const fuelCost=Math.floor(neo.fuelCost*(1-gameState.upgrades.fuelEfficiency*0.1));
  const opCost=neo.operationCost;
  const netProfit=neo.miningValue-fuelCost-opCost;
  const failureRate=Math.min(0.95, Math.max(0.01, (neo.failureRate-gameState.upgrades.successBonus*0.02) * gameState.failureMultiplier));
  const canAffordMining=gameState.credits>=(fuelCost+opCost);
  const deflectCost=Math.floor((neo.deflectCost||0)*(1-gameState.upgrades.deflectionPower*0.15));
  const canAffordDeflect=neo.dangerous&&gameState.credits>=deflectCost;
  const activeShipsCount=neos.filter(n=>n.onMission).length;
  const canLaunch=activeShipsCount<gameState.maxShips;
  const remaining=neo.maxMineCount-neo.mineCount;
  let impactWarning='';
  if(neo.dangerous&&!neo.deflected&&!neo.deflecting&&neo.impactTime>0){
    const minutes=Math.floor(neo.impactTime/60000);
    const seconds=Math.floor((neo.impactTime%60000)/1000);
    impactWarning=`<div class="impact-timer">⚠ IMPACT IN ${minutes}:${seconds.toString().padStart(2,'0')}</div>`;
  }

  div.innerHTML=
    `<div style="border:2px solid #00ffff; padding:15px; border-radius:5px;">
      <h3 style="color:#00ffff;">SELECTED: ${neo.name}</h3>
      <div style="font-size:11px; color:#88ccff; margin:5px 0;">
        <div>Mining Value: ${neo.miningValue.toLocaleString()}</div>
        <div>Fuel Cost: -${fuelCost.toLocaleString()} ${gameState.upgrades.fuelEfficiency>0?'✓':''}</div>
        <div>Operation Cost: -${opCost.toLocaleString()}</div>
        <div style="color:#00ff88; font-weight:bold;">Net Profit: ${netProfit.toLocaleString()}</div>
        <div style="color:${failureRate>0.12?'#ff8800':'#88ccff'}; margin-top:5px;">Success Chance: ${((1-failureRate)*100).toFixed(0)}% ${gameState.upgrades.successBonus>0?'✓':''}</div>
        <div style="color:${remaining<=5?'#ff8800':'#ffaa00'}; font-weight:bold;">Resources: ${remaining}/${neo.maxMineCount}</div>
        ${neo.dangerous?`<div class="dangerous">⚠ THREAT LEVEL ${neo.threatLevel}/10</div>`:''}
        ${neo.dangerous&&!neo.deflected&&!neo.deflecting?`<div>Deflection Cost: ${deflectCost.toLocaleString()} ${gameState.upgrades.deflectionPower>0?'✓':''}</div>`:''}
        ${neo.deflecting?'<div class="log-success">🚀 DEFLECTING...</div>':''}
        ${neo.depleting?'<div class="log-warning">⚠ RESOURCE DEPLETED...</div>':''}
        ${impactWarning}
      </div>
      <button id="miningBtn-${neo.id}" data-neo-id="${neo.id}" ${!canAffordMining||neo.onMission||!canLaunch||neo.deflecting||neo.depleting||remaining<=0?'disabled':''}>
        ${neo.depleting?'DEPLETED':!canLaunch&&!neo.onMission?'ALL SHIPS ACTIVE':neo.onMission?'MISSION IN PROGRESS':remaining<=0?'DEPLETED':'LAUNCH MINING MISSION'}
      </button>
      ${neo.dangerous&&!neo.deflected&&!neo.deflecting?`<button id="deflectBtn-${neo.id}" class="deflect-btn" data-neo-id="${neo.id}" ${!canAffordDeflect||neo.onMission||!canLaunch||neo.depleting?'disabled':''}>
        ${!canLaunch?'ALL SHIPS ACTIVE':'DEFLECT ASTEROID'}
      </button>`:''}
    </div>`;

  const miningBtn=document.getElementById(`miningBtn-${neo.id}`);
  if(miningBtn){
    miningBtn.onclick=()=>launchMiningMission(neo.id);
  }
  const deflectBtn=document.getElementById(`deflectBtn-${neo.id}`);
  if(deflectBtn){
    deflectBtn.onclick=()=>deflectAsteroid(neo.id);
  }
}
function renderUpgrades(){
  const upgrades=[
    {id:'fuelEfficiency',name:'Fuel Efficiency',desc:'Reduce fuel costs by 10% per level',max:5},
    {id:'successBonus',name:'Mission Success',desc:'Improve success rate by 2% per level',max:5},
    {id:'deflectionPower',name:'Deflection Tech',desc:'Reduce deflection costs by 15% per level',max:3},
    {id:'shipCapacity',name:'Fleet Expansion',desc:'Add 1 ship capacity per level',max:3}
  ];
  let html='';
  upgrades.forEach(up=>{
    const level=gameState.upgrades[up.id];
    const cost=getCost(up.id,level);
    const canAfford=gameState.credits>=cost;
    const maxed=level>=up.max;
    html+=
      `<div class="upgrade-item">
        <div class="upgrade-name">${up.name}</div>
        <div class="upgrade-desc">${up.desc}</div>
        <div class="upgrade-level">Level: ${level}/${up.max}</div>
        <button class="upgrade-btn" ${!canAfford||maxed?'disabled':''} id="upgrade-${up.id}">
          ${maxed?'MAX LEVEL':`UPGRADE - ${cost.toLocaleString()}`}
        </button>
      </div>`;
  });
  document.getElementById('upgradesList').innerHTML=html;
  upgrades.forEach(up=>{
    const btn=document.getElementById('upgrade-'+up.id);
    if(btn){
      btn.onclick=()=>purchaseUpgrade(up.id);
    }
  });
}
function getCost(id,level){
  const costs={fuelEfficiency:200000,successBonus:250000,deflectionPower:300000,shipCapacity:500000};
  return costs[id]*(level+1);
}
function purchaseUpgrade(id){
  const level=gameState.upgrades[id];
  const maxLevels={fuelEfficiency:5,successBonus:5,deflectionPower:3,shipCapacity:3};
  const cost=getCost(id,level);
  if(gameState.credits<cost||level>=maxLevels[id])return;
  gameState.credits-=cost;
  gameState.upgrades[id]++;
  if(id==='shipCapacity')gameState.maxShips++;
  showNotification(`Upgraded ${id}!`,'success');
  renderUpgrades();
  updateUI();
}
function renderAchievements(){
  let html='';
  const achievements=[
    {key:'firstMillion',check:()=>gameState.totalProfit>=1000000},
    {key:'safetyFirst',check:()=>gameState.achievements.safetyFirst.count>=3,progress:gameState.achievements.safetyFirst.count+'/3'},
    {key:'miningMogul',check:()=>gameState.missionsCompleted>=50,progress:gameState.missionsCompleted+'/50'},
    {key:'perfectRecord',check:()=>gameState.achievements.perfectRecord.streak>=10,progress:gameState.achievements.perfectRecord.streak+'/10'},
    {key:'entrepreneur',check:()=>gameState.credits>=5000000}
  ];
  achievements.forEach(ach=>{
    const achievement=gameState.achievements[ach.key];
    const unlocked=achievement.unlocked;
    const progress=ach.progress? ` (${ach.progress})`:''; 
    html+=
      `<div class="achievement ${unlocked?'unlocked':''}">
        <div style="font-weight:bold; margin-bottom:3px;">${unlocked?'✓':''} ${achievement.name}</div>
        <div style="color:#88ccff;">${achievement.desc}${!unlocked?progress:''}</div>
      </div>`;
  });
  document.getElementById('achievementsList').innerHTML=html;
}

function checkAchievements(){
  if(!gameState.achievements.firstMillion.unlocked && gameState.totalProfit>=1000000){
    gameState.achievements.firstMillion.unlocked=true;
    showNotification('Achievement unlocked: First Million!','success');
  }
  if(!gameState.achievements.safetyFirst.unlocked && gameState.achievements.safetyFirst.count>=3){
    gameState.achievements.safetyFirst.unlocked=true;
    showNotification('Achievement unlocked: Safety First!','success');
  }
  if(!gameState.achievements.miningMogul.unlocked && gameState.missionsCompleted>=50){
    gameState.achievements.miningMogul.unlocked=true;
    showNotification('Achievement unlocked: Mining Mogul!','success');
  }
  if(!gameState.achievements.perfectRecord.unlocked && gameState.achievements.perfectRecord.streak>=10){
    gameState.achievements.perfectRecord.unlocked=true;
    showNotification('Achievement unlocked: Perfect Record!','success');
  }
  if(!gameState.achievements.entrepreneur.unlocked && gameState.credits>=5000000){
    gameState.achievements.entrepreneur.unlocked=true;
    showNotification('Achievement unlocked: Entrepreneur!','success');
  }
  if(checkVictory()){
    gameState.gameWon=true;
    showGameOver('VICTORY - All Achievements Unlocked!',true);
  }
}
function checkVictory(){
  return Object.values(gameState.achievements).every(a=>a.unlocked);
}

function launchMiningMission(id){
  const neo=neos.find(n=>n.id===id);
  if(!neo||neo.onMission||neo.depleting)return;
  if(neo.mineCount>=neo.maxMineCount)return;
  const fuelCost=Math.floor(neo.fuelCost*(1-gameState.upgrades.fuelEfficiency*0.1));
  const opCost=neo.operationCost;
  if(gameState.credits<(fuelCost+opCost))return;
  const activeShipsCount=neos.filter(n=>n.onMission).length;
  if(activeShipsCount>=gameState.maxShips)return;

  gameState.credits-=fuelCost+opCost;
  neo.onMission=true;

  const btn = document.getElementById(`miningBtn-${id}`);
  if(btn) {
    btn.disabled = true;
    btn.textContent = 'MISSION IN PROGRESS';
  }

  updateUI();
  renderNEOList();
  showNotification(`Launching mining mission for ${neo.name}`,'info');
  setTimeout(()=>{
    const rawFailure = Math.max(0.01, neo.failureRate - gameState.upgrades.successBonus*0.02);
    const failureRate = Math.min(0.95, rawFailure * gameState.failureMultiplier);
    const success=Math.random()>=failureRate;
    if(success){
      gameState.credits+=neo.miningValue;
      gameState.totalProfit+=neo.miningValue-(fuelCost+opCost);
      gameState.missionsCompleted++;
      neo.mineCount++;
      gameState.achievements.perfectRecord.streak++;
      showNotification(`Mission success! Earned ${neo.miningValue.toLocaleString()} (${neo.maxMineCount-neo.mineCount} left)`,'success');
      if(neo.mineCount>=neo.maxMineCount){
        depleteNEO(neo.id);
      }
    }else{
      gameState.achievements.perfectRecord.streak=0;
      gameState.missionsFailed++;
      showNotification('Mission failed!','danger');
    }
    neo.onMission=false;
    checkAchievements();
    renderSelectedNEO();
    renderNEOList();
    updateUI();
  },3000);
}
function depleteNEO(id){
  const neoToDeplete = neos.find(n=>n.id===id);
  if(!neoToDeplete) return;
  neoToDeplete.depleting=true;
  neoToDeplete.depletionProgress=0;
  showNotification(`${neoToDeplete.name} resources depleted!`,'warning');
  const depletionInterval=setInterval(()=>{
    if(!neoToDeplete.depleting)return;
    neoToDeplete.depletionProgress+=0.02;
    if(neoToDeplete.depletionProgress>=1){
      clearInterval(depletionInterval);
      neoToDeplete.depleting=false;
      explosions.push({x:neoToDeplete.x,y:neoToDeplete.y,radius:25,life:30});
      showNotification(`${neoToDeplete.name} has fragmented into space debris`,'info');
      replaceNEO(neoToDeplete.id);
      renderNEOList();
      renderSelectedNEO();
    }
  },50);
}
function deflectAsteroid(id){
  const neo=neos.find(n=>n.id===id);
  if(!neo||neo.deflected)return;
  const deflectCost=Math.floor((neo.deflectCost||0)*(1-gameState.upgrades.deflectionPower*0.15));
  if(gameState.credits<deflectCost)return;
  const activeShipsCount=neos.filter(n=>n.onMission).length;
  if(activeShipsCount>=gameState.maxShips)return;
  gameState.credits-=deflectCost;
  neo.deflected=true;
  neo.deflecting=true;
  neo.deflectProgress=0;
  gameState.achievements.safetyFirst.count++;
  showNotification(`Deflection mission launched for ${neo.name}`,'info');
  updateUI();
  renderSelectedNEO();
  const deflectInterval=setInterval(()=>{
    if(!neo.deflecting)return;
    neo.deflectProgress+=0.02;
    neo.distance+=3;
    if(neo.deflectProgress>=1){
      clearInterval(deflectInterval);
      neo.deflecting=false;
      explosions.push({x:neo.x,y:neo.y,radius:30,life:40});
      showNotification(`${neo.name} successfully deflected!`,'success');
      checkAchievements();
      replaceNEO(neo.id);
      renderNEOList();
      renderSelectedNEO();
    }
  },50);
}
function replaceNEO(oldId){
  const names=['Ceres','Vesta','Pallas','Hygiea','Interamnia','Europa','Davida','Sylvia','Cybele','Eunomia','Juno','Euphrosyne','Hektor','Thisbe','Bamberger','Iris','Fortuna','Egeria','Themis','Aurora'];
  const suffixes=['Alpha','Beta','Gamma','Delta','Epsilon','Zeta','Prime','Nova','X','Y','Ultra','Neo','Omega'];
  const isDangerous=Math.random()<gameState.dangerousSpawnRate;
  const distance=120+Math.random()*220;
  const size=6+Math.random()*9;
  const name=names[Math.floor(Math.random()*names.length)]+'-'+suffixes[Math.floor(Math.random()*suffixes.length)];
  const colors=['#ffaa00','#00ffff','#cc88ff','#ff4444','#88ff88','#ff88ff','#00ff88','#ffcc00'];
  const neo={
    id:oldId,
    name:name,
    x:0,y:0,
    angle:Math.random()*Math.PI*2,
    distance:distance,
    speed:0.003+Math.random()*0.01,
    size:size,
    color:colors[Math.floor(Math.random()*colors.length)],
    dangerous:isDangerous,
    onMission:false,
    deflected:false,
    deflecting:false,
    deflectProgress:0,
    mineCount:0,
    maxMineCount: randResources(),
    depleting:false,
    depletionProgress:0
  };
  if(isDangerous){
    neo.threatLevel=Math.floor(1 + Math.random()*10);
    neo.impactTime = impactTimeFromThreat(neo.threatLevel);
    neo.deflectCost=Math.floor(200000+Math.random()*300000);
  }
  neo.failureRate = 0.05 + Math.random()*0.25;
  neo.miningValue=Math.floor((400000+Math.random()*1200000)*(size/10));
  neo.fuelCost=Math.floor(neo.distance*400+Math.random()*60000);
  neo.operationCost=Math.floor(neo.fuelCost*0.6+Math.random()*40000);
  const index=neos.findIndex(n=>n.id===oldId);
  if(index!==-1)neos[index]=neo;
  showNotification(`New NEO detected: ${name} ${isDangerous?`⚠ DANGEROUS (TL ${neo.threatLevel})`:''}`,'info');
}
function impactEarth(neo){
  gameState.gameOver=true;
  showNotification(`IMPACT! ${neo.name} hit Earth!`,'danger');
  explosions.push({x:0,y:0,radius:50,life:60});
  gameState.credits-=2000000;
  updateUI();
  showGameOver(`GAME OVER - ${neo.name} impacted Earth!`,false);
}
function checkGameOver(){
  if(gameState.credits<0&&!gameState.gameOver){
    gameState.gameOver=true;
    showGameOver('GAME OVER - Company Bankrupt!',false);
  }
}
function showGameOver(msg,victory){
  const overlay=document.createElement('div');
  overlay.className='game-over'+(victory?' victory':'');
  const achievementCount=Object.values(gameState.achievements).filter(a=>a.unlocked).length;
  
  const playTime = Date.now() - gameState.startTime;
  const hours = Math.floor(playTime / 3600000);
  const minutes = Math.floor((playTime % 3600000) / 60000);
  const seconds = Math.floor((playTime % 60000) / 1000);
  const timeString = hours > 0 
    ? `${hours}h ${minutes}m ${seconds}s`
    : minutes > 0 
      ? `${minutes}m ${seconds}s`
      : `${seconds}s`;
  
  overlay.innerHTML=
    `<h2>${msg}</h2>
    <div style="color:#88ccff; font-size:18px; margin:20px 0;">Final Capital: ${gameState.credits.toLocaleString()}</div>
    <div style="color:#00ff88; font-size:18px;">Total Profit: ${gameState.totalProfit.toLocaleString()}</div>
    <div style="color:#ffaa00; font-size:16px; margin:10px 0;">Missions: ${gameState.missionsCompleted} completed</div>
    <div style="color:#cc88ff; font-size:16px;">Achievements: ${achievementCount}/5</div>
    <div style="color:#00ffff; font-size:16px; margin-top:10px;">Time Survived: ${timeString}</div>
    <button onclick="location.reload()" style="margin-top:20px; width:200px;">RESTART MISSION</button>`;
  document.body.appendChild(overlay);
}
function updateUI(){
  document.getElementById('credits').textContent=gameState.credits.toLocaleString();
  document.getElementById('totalProfit').textContent=gameState.totalProfit.toLocaleString();
  const activeCount=neos.filter(n=>n.onMission).length;
  document.getElementById('activeShips').textContent=`${activeCount}/${gameState.maxShips}`;
  const nextCostTime=Math.ceil((30000-(Date.now()-gameState.lastOperationalCost))/1000);
  document.getElementById('nextOpCost').textContent=`${nextCostTime}s (-${gameState.operationalCostPerCycle.toLocaleString()})`;
  checkGameOver();
}

renderNEOList();
renderSelectedNEO();
renderUpgrades();
renderAchievements();
animate();

function showNotification(msg, type='info'){
  const notification = document.createElement('div');
  notification.className = 'notification ' + type;
  notification.textContent = msg;
  
  const existingNotifications = document.querySelectorAll('.notification');
  const offset = existingNotifications.length * 80;
  notification.style.top = (20 + offset) + 'px';
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    if(notification.parentNode) {
      notification.parentNode.removeChild(notification);
    }
  }, 4000);
}
</script>
</body>
</html>