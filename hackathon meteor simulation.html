<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asteroid Impact Simulator</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; display:flex; }
  #map { height: 100vh; flex:1; }
  .controls { 
    position:absolute; 
    top:10px; 
    left:60px; 
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.3);
    padding:10px; 
    border-radius:20px; 
    z-index:1000; 
    width:300px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  }
  .preset-label {
    font-size: 13px;
    font-weight: 600;
    color: #555;
    margin-bottom: 8px;
    display: block;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  select { 
    width: 100%; 
    padding: 10px 15px;
    border: 2px solid rgba(0, 0, 0, 0.1);
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.9);
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    outline: none;
  }
  select:hover {
    border-color: rgba(0, 0, 0, 0.2);
    background: rgba(255, 255, 255, 1);
  }
  select:focus {
    border-color: #3a86ff;
    box-shadow: 0 0 0 3px rgba(58, 134, 255, 0.1);
  }
  button { padding: 8px 15px; margin-top: 10px; cursor: pointer; }

  .results { 
    padding:20px; 
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.3);
    position:absolute; 
    bottom:20px; 
    right:10px; 
    border-radius:20px; 
    z-index:1000;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    min-width: 300px;
  }
  .results h3 {
    margin-top: 0;
    color: #333;
    font-weight: 700;
  }
  .results #output {
    color: #555;
    line-height: 1.8;
  }

  .sidebar {
    height: 100vh;
    width: 0;
    position: fixed;
    top: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-left: 1px solid rgba(255, 255, 255, 0.1);
    overflow-x: hidden;
    transition: 0.4s;
    padding-top: 60px;
    color: white;
    z-index:2000;
    box-shadow: -8px 0 32px rgba(0, 0, 0, 0.3);
  }
  .sidebar h2 { padding-left:20px; }
  .sidebar p { padding: 10px 20px; line-height:1.5; }
  .sidebar .closebtn {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 30px;
    cursor: pointer;
    color: white;
  }

  .simulateimpact {
    font-size: 17px;
    padding: 10px 20px;
    border: none;
    border-radius: 0.6rem;
    background: black;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
  }

  .simulateimpact:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-3px);
    color: #ff0000;
  }
  .shareResults {
    font-size: 17px;
    padding: 10px 20px;
    border: none;
    border-radius: 0.6rem;
    background: black;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
  }

  .shareResults:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-3px);
    color: #ffffff;
  }
  nav button:active {
    transform: translateY(0) scale(0.97);
  }
  .openbtn {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 18px;
    background-color: #111;
    color: white;
    padding: 10px 15px;
    border: none;
    cursor: pointer;
    border-radius:5px;
    z-index:1500;
    transition: all 0.3s ease-in-out;
  }
  .openbtn:hover { 
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-3px);
    color: #000000; 
  }

  .share-modal {
    display: none;
    position: fixed;
    z-index: 5000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
    backdrop-filter: blur(10px);
  }

  .share-modal-content {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    margin: 10% auto;
    padding: 30px;
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    color: white;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from { transform: translateY(-50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .share-close {
    color: white;
    float: right;
    font-size: 32px;
    font-weight: bold;
    cursor: pointer;
    line-height: 20px;
  }

  .share-close:hover { color: #ffeb3b; }

  .share-link-box {
    background: rgba(255,255,255,0.2);
    padding: 15px;
    border-radius: 12px;
    margin: 20px 0;
    word-break: break-all;
    font-family: monospace;
    border: 2px solid rgba(255,255,255,0.3);
  }

  .copy-btn {
    background: white;
    color: #667eea;
    border: none;
    padding: 12px 24px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    font-size: 16px;
    transition: all 0.3s ease;
    width: 100%;
    margin-top: 10px;
  }

  .copy-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(255,255,255,0.4);
  }

  .copy-btn:active {
    transform: translateY(0);
  }

  #flash {
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:white;
    opacity:0;
    pointer-events:none;
    z-index:3000;
    transition: opacity 0.3s ease;
  }

  #explosion {
    position: absolute;
    border-radius: 50%;
    background: rgba(255,165,0,0.5);
    pointer-events: none;
    z-index: 4000;
    transform: translate(-50%, -50%);
  }

  .slider-container {
    position: relative;
    width: 100%;
    margin: 20px 0;
  }
  
  .slider-label {
    font-size: 12px;
    color: #666;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  
  .slider {
    -webkit-appearance: none;
    width: 100%;
    height: 10px;
    border-radius: 5px;
    outline: none;
    cursor: pointer;
    position: relative;
    z-index: 1;
  }
  
  .slider1 {
    background: linear-gradient(90deg, #00ff22, #ffd900, #ff8859, #ff0000);
    box-shadow: 0 2px 8px rgba(131, 56, 236, 0.4);
  }
  
  .slider2 {
    background: linear-gradient(90deg, #48ff00, #ffd900, #ff9100, #ff0000);
    box-shadow: 0 2px 8px rgba(114, 9, 183, 0.4);
  }
  
  .slider3 {
    background: linear-gradient(90deg, #ff9e00, #ff6d00, #ff3d00, #dd2c00);
    box-shadow: 0 2px 8px rgba(255, 61, 0, 0.4);
  }
  
  .slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid #fff;
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  
  .slider1::-webkit-slider-thumb {
    background: linear-gradient(135deg, #06ffa5, #3a86ff);
    box-shadow: 0 4px 12px rgba(6, 255, 165, 0.5);
  }
  
  .slider2::-webkit-slider-thumb {
    background: linear-gradient(135deg, #4361ee, #3a0ca3);
    box-shadow: 0 4px 12px rgba(67, 97, 238, 0.5);
  }
  
  .slider3::-webkit-slider-thumb {
    background: linear-gradient(135deg, #ff9e00, #ff3d00);
    box-shadow: 0 4px 12px rgba(255, 158, 0, 0.5);
  }
  
  .slider:active::-webkit-slider-thumb {
    transform: scale(1.3);
    animation: bounce 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }
  
  .slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid #fff;
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  
  .slider1::-moz-range-thumb {
    background: linear-gradient(135deg, #000000, #3a3a3a);
    box-shadow: 0 4px 12px rgba(6, 255, 165, 0.5);
  }
  
  .slider2::-moz-range-thumb {
    background: linear-gradient(135deg, #ffffff, #414141);
    box-shadow: 0 4px 12px rgba(67, 97, 238, 0.5);
  }
  
  .slider3::-moz-range-thumb {
    background: linear-gradient(135deg, #ff9e00, #ff3d00);
    box-shadow: 0 4px 12px rgba(255, 158, 0, 0.5);
  }
  
  .slider:active::-moz-range-thumb {
    transform: scale(1.3);
    animation: bounce 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }
  
  @keyframes bounce {
    0%   { transform: scale(1.3) translateY(0); }
    40%  { transform: scale(1.3) translateY(-10px); }
    65%  { transform: scale(1.3) translateY(-5px); }
    80%  { transform: scale(1.3) translateY(-8px); }
    100% { transform: scale(1.3) translateY(0); }
  }
  
  .sliderValue {
    position: absolute;
    top: 40px;
    font-size: 16px;
    font-weight: bold;
    transform: translateX(0);
    pointer-events: none;
    transition: transform 0.1s ease;
  }
  
  .value1 {
    color: #4e4e4e;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.4);
  }
  
  .value2 {
    color: #414141;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.4);
  }
  
  .value3 {
    color: #5a5a5a;
    text-shadow: 0 0 8px rgba(0, 0, 0, 0.4);
  }
  .huz1-btn {
  width: 100px;
  height: 30px;
  margin-top: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  position: relative;
  background: #e62222;
  border: none;
  border-radius: 4px;
  box-shadow: 1px 1px 3px rgba(0,0,0,0.15);
  transition: 200ms;
  font-size: 10px; 
}

.huz1-btn span {
  transition: 200ms;
}

.huz1-text {
  transform: translateX(18px);
  color: white;
  font-weight: bold;
}

.huz1-icon {
  position: absolute;
  border-left: 1px solid #c41b1b;
  transform: translateX(65px);
  height: 22px;
  width: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.huz1-icon svg {
  width: 10px;
  fill: #eee;
}

.huz1-btn:hover {
  background: #ff3636;
}

.huz1-btn:hover .huz1-text {
  color: transparent;
}

.huz1-btn:hover .huz1-icon {
  width: 90px;
  border-left: none;
  transform: translateX(0);
}

.huz1-btn:focus {
  outline: none;
}

.huz1-btn:active .huz1-icon svg {
  transform: scale(0.8);
}
</style>
</head>
<body>

<div class="controls">
  <div class="preset-label">Asteroid Preset</div>
  <select id="preset" onchange="applyPreset()">
    <option value="">Select a preset</option>
    <option value="101955 Bennu">101955 Bennu</option>
    <option value="1620 Geographos">1620 Geographos</option>
    <option value="Kamchatka meteor">Kamchatka meteor</option>
    <option value="2025 BP6">2025 BP6</option>
    <option value="2025 ME92">2025 ME92</option>
  </select><br><br>

  <div class="slider-container">
    <div class="slider-label">Diameter (m)</div>
    <input type="range" min="10" max="50000" value="1000" id="diameter" class="slider slider1" oninput="updateSliderValue('diameter', 'diameterValue')">
    <div id="diameterValue" class="sliderValue value1">1000</div>
  </div>

  <div class="slider-container">
    <div class="slider-label">Velocity (m/s)</div>
    <input type="range" min="5000" max="30000" value="17000" id="velocity" class="slider slider2" oninput="updateSliderValue('velocity', 'velocityValue')">
    <div id="velocityValue" class="sliderValue value2">17000</div>
  </div>

  <div class="slider-container">
    <div class="slider-label">Impact Angle (deg)</div>
    <input type="range" min="15" max="90" value="45" id="angle" class="slider slider3" oninput="updateSliderValue('angle', 'angleValue')">
    <div id="angleValue" class="sliderValue value3">45</div>
  </div>

  <button class="simulateimpact" onclick="simulateImpact()">Simulate Impact</button>
  <button class="shareResults" onclick="shareResults()" style="margin-top:10px; background:#1e90ff;"> Share Results</button>
  <button class="huz1-btn" onclick="window.location.href='index.html'">
  <span class="huz1-text">Go Back</span>
  <span class="huz1-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path>
    </svg>
  </span>
</button>
</div>

<button class="openbtn" onclick="openSidebar()">ℹ Info</button>

<div id="map"></div>

<div class="results">
  <h3>Impact Results</h3>
  <div id="output"></div>
</div>

<div id="sidebar" class="sidebar">
  <a class="closebtn" onclick="closeSidebar()">×</a>
  <h2>Impact Layers</h2>
  <p><span style="color:brown;">• Crater:</span> The final crater left by the impact.</p>
  <p><span style="color:orange;">• Fireball:</span> The zone of intense heat radiation from the impact.</p>
  <p><span style="color:#0044cc;">• Shockwave (~5 psi):</span> Strong blast wave capable of severe destruction.</p>
  <p><span style="color:#66ccff;">• Shockwave (~3.25 psi):</span> Lighter blast wave still causing structural damage.</p>
  <p>Click anywhere on the map to set the impact location.</p>
</div>

<div id="shareModal" class="share-modal">
  <div class="share-modal-content">
    <span class="share-close" onclick="closeShareModal()">&times;</span>
    <h2 style="margin-top:0;">📤 Share Your Impact</h2>
    <p>Copy this link to share your asteroid impact simulation:</p>
    <div class="share-link-box" id="shareLink"></div>
    <button class="copy-btn" onclick="copyShareLink()">📋 Copy Link</button>
    <p style="font-size:12px; margin-top:20px; opacity:0.8;">Anyone with this link will see your exact simulation parameters and location.</p>
  </div>
</div>

<div id="flash"></div>
<div id="explosion"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let impactLat = 0;
let impactLon = 0;

let map = L.map('map').setView([0,0],2);

L.tileLayer(
  'https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/BlueMarble_NextGeneration/default/2020-01-01/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg',
  {
    attribution: 'NASA Blue Marble Next Generation',
    maxZoom: 9,
    tileSize: 256,
    zoomOffset: 0
  }
).addTo(map);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap',
  opacity: 0.4
}).addTo(map);

let marker, craterCircle, fireballCircle, shockCircle5, shockCircle3;

const presets = {
  "101955 Bennu": {diameter:490, velocity:2800, angle:45},
  "1620 Geographos": {diameter:2500, velocity:20000, angle:45},
  "Kamchatka meteor": {diameter:10, velocity:32000, angle:7},
  "2025 BP6": {diameter:300, velocity:12000, angle:45},
  "2025 ME92": {diameter:250, velocity:15000, angle:45}
};

function updateSliderValue(sliderId, valueId) {
  const slider = document.getElementById(sliderId);
  const output = document.getElementById(valueId);
  const val = slider.value;
  const max = slider.max;
  const min = slider.min;
  const percent = (val - min) / (max - min);
  const sliderWidth = slider.offsetWidth;
  const thumbOffset = 10;
  const posX = percent * sliderWidth - thumbOffset;
  
  output.textContent = val;
  output.style.transform = 'translateX(' + posX + 'px)';
}

function applyPreset() {
  const presetName = document.getElementById('preset').value;
  if(presets[presetName]){
    document.getElementById('diameter').value = presets[presetName].diameter;
    document.getElementById('velocity').value = presets[presetName].velocity;
    document.getElementById('angle').value = presets[presetName].angle;
    updateSliderValue('diameter', 'diameterValue');
    updateSliderValue('velocity', 'velocityValue');
    updateSliderValue('angle', 'angleValue');
  }
}

map.on('click', function(e) {
  impactLat = e.latlng.lat;
  impactLon = e.latlng.lng;
  if(marker) map.removeLayer(marker);
  marker = L.marker([impactLat, impactLon]).addTo(map).bindPopup("Impact Location").openPopup();
});

function animateExplosion(lat, lon, maxRadius) {
  let point = map.latLngToContainerPoint([lat, lon]);
  let explosion = document.getElementById('explosion');
  explosion.style.left = point.x + 'px';
  explosion.style.top = point.y + 'px';
  explosion.style.width = '0px';
  explosion.style.height = '0px';
  explosion.style.display = 'block';
  explosion.style.opacity = 0.7;

  let start = null;
  function step(timestamp) {
    if (!start) start = timestamp;
    let progress = (timestamp - start)/1000;
    let radius = Math.min(maxRadius, progress*maxRadius*2);
    explosion.style.width = radius*2 + 'px';
    explosion.style.height = radius*2 + 'px';
    explosion.style.opacity = 0.7 * (1 - progress);
    if (radius < maxRadius) {
      requestAnimationFrame(step);
    } else {
      explosion.style.display = 'none';
    }
  }
  requestAnimationFrame(step);
}

function simulateImpact() {
  let d = parseFloat(document.getElementById('diameter').value);
  let v = parseFloat(document.getElementById('velocity').value);
  let angle_deg = parseFloat(document.getElementById('angle').value);

  let rho_i = 1800.0, rho_t = 2700.0, sigma = 5e6, rho0 = 1.225, H = 8000.0, g = 9.81;
  let theta = angle_deg*Math.PI/180;
  let mass = rho_i*Math.PI/6*Math.pow(d,3);
  let E = 0.5*mass*v*v;
  let v_vertical = v*Math.sin(theta);
  let arg = (2.0*sigma)/(rho0*v_vertical*v_vertical);
  let h_breakup = (arg<1.0)?-H*Math.log(arg):null;
  let airburst = (h_breakup && h_breakup/1000<20);

  let Dtc = 1.161*Math.pow(rho_i/rho_t,1/3)*Math.pow(d,0.78)*Math.pow(v,0.44)*Math.pow(g,-0.22)*Math.pow(Math.sin(theta),1/3);
  let Dtc_km = Dtc/1000;
  let Dfr_km = (Dtc_km>2.56)?1.17*Math.pow(Dtc_km,1.13)/Math.pow(3.2,0.13):1.25*Dtc_km;

  let Rf = 0.002*Math.pow(E,1/3);
  let fireball_diam_km = 2*Rf/1000;
  let E_kt = E/4.184e12;

  let table = [[126,426000],[133,379000],[149,297000],[155,273000],[229,121000],[251,100000],
               [389,42600],[411,38500],[502,26800],[549,22900],[1160,6900]];

  function shock_radius(p_target){
    table.sort((a,b)=>b[1]-a[1]);
    let d1=null;
    for(let i=0;i<table.length-1;i++){
      let p1=table[i][1], p2=table[i+1][1];
      if(p1>=p_target && p_target>=p2){
        let dist1=table[i][0], dist2=table[i+1][0];
        d1=dist1 + (p_target-p1)*(dist2-dist1)/(p2-p1);
        break;
      }
    }
    if(d1===null) d1=(p_target>table[0][1])?table[0][0]:table[table.length-1][0];
    return d1*Math.pow(E_kt,1/3)/1000;
  }

  let p_5psi = 5*6894.75729;
  let p_3_25psi = 22376.2684;
  let r_5psi = shock_radius(p_5psi);
  let r_3_25psi = shock_radius(p_3_25psi);
  let richter = 0.67*Math.log10(E)-5.87;

  let output="";
  output+=`Mass: ${mass.toExponential(3)} kg<br>`;
  output+=`Kinetic Energy: ${E.toExponential(3)} J (${(E_kt/1000).toFixed(2)} Mt TNT)<br>`;
  output+=`Final crater diameter: ${Dfr_km.toFixed(2)} km<br>`;
  output+=`Fireball diameter: ${fireball_diam_km.toFixed(2)} km<br>`;
  output+=`Shockwave radius (~5 psi): ${r_5psi.toFixed(2)} km<br>`;
  output+=`Shockwave radius (~3.25 psi): ${r_3_25psi.toFixed(2)} km<br>`;

  document.getElementById('output').innerHTML = output;

  if (craterCircle) map.removeLayer(craterCircle);
  if (fireballCircle) map.removeLayer(fireballCircle);
  if (shockCircle5) map.removeLayer(shockCircle5);
  if (shockCircle3) map.removeLayer(shockCircle3);

  craterCircle = L.circle([impactLat, impactLon], {radius: Dfr_km*500, color:'brown', fillOpacity:0.5}).addTo(map);
  fireballCircle = L.circle([impactLat, impactLon], {radius: fireball_diam_km*500, color:'orange', fillOpacity:0.3}).addTo(map);
  shockCircle5 = L.circle([impactLat, impactLon], {radius: r_5psi*1000, color:'#0044cc', fillOpacity:0.2}).addTo(map);
  shockCircle3 = L.circle([impactLat, impactLon], {radius: r_3_25psi*1000, color:'#66ccff', fillOpacity:0.2}).addTo(map);

  let flash = document.getElementById('flash');
  flash.style.opacity = Math.min(0.8, Math.log10(E)/10);
  setTimeout(()=>{flash.style.opacity=0;}, 300);

  animateExplosion(impactLat, impactLon, Dfr_km*60);
  map.setView([impactLat, impactLon], 4);
}

function shareResults() {
  if (!marker) {
    alert('Please click on the map to select an impact location first!');
    return;
  }
  
  const d = document.getElementById('diameter').value;
  const v = document.getElementById('velocity').value;
  const a = document.getElementById('angle').value;
  
  const baseUrl = window.location.origin + window.location.pathname;
  const shareUrl = `${baseUrl}?d=${d}&v=${v}&a=${a}&lat=${impactLat.toFixed(6)}&lon=${impactLon.toFixed(6)}`;
  
  document.getElementById('shareLink').textContent = shareUrl;
  document.getElementById('shareModal').style.display = 'block';
}

function closeShareModal() {
  document.getElementById('shareModal').style.display = 'none';
}

function copyShareLink() {
  const linkText = document.getElementById('shareLink').textContent;
  navigator.clipboard.writeText(linkText).then(() => {
    const btn = document.querySelector('.copy-btn');
    const originalText = btn.textContent;
    btn.textContent = '✅ Copied!';
    btn.style.background = '#4caf50';
    btn.style.color = 'white';
    setTimeout(() => {
      btn.textContent = originalText;
      btn.style.background = 'white';
      btn.style.color = '#667eea';
    }, 2000);
  }).catch(err => {
    alert('Failed to copy link. Please copy it manually.');
  });
}

function loadFromURL() {
  const params = new URLSearchParams(window.location.search);
  if (params.has('d') && params.has('v') && params.has('a') && params.has('lat') && params.has('lon')) {
    document.getElementById('diameter').value = params.get('d');
    document.getElementById('velocity').value = params.get('v');
    document.getElementById('angle').value = params.get('a');
    impactLat = parseFloat(params.get('lat'));
    impactLon = parseFloat(params.get('lon'));
    
    updateSliderValue('diameter', 'diameterValue');
    updateSliderValue('velocity', 'velocityValue');
    updateSliderValue('angle', 'angleValue');
    
    if(marker) map.removeLayer(marker);
    marker = L.marker([impactLat, impactLon]).addTo(map).bindPopup("Shared Impact Location").openPopup();
    
    setTimeout(() => {
      simulateImpact();
    }, 500);
  }
}

function openSidebar() { document.getElementById("sidebar").style.width = "300px"; }
function closeSidebar() { document.getElementById("sidebar").style.width = "0"; }

window.onclick = function(event) {
  const modal = document.getElementById('shareModal');
  if (event.target == modal) {
    closeShareModal();
  }
}

updateSliderValue('diameter', 'diameterValue');
updateSliderValue('velocity', 'velocityValue');
updateSliderValue('angle', 'angleValue');

loadFromURL();
</script>
</body>
</html>